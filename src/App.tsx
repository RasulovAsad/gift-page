import React, { useEffect, useMemo, useRef, useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { Heart, Lock, Unlock, Gift, Camera, Sparkles, Timer, Trophy, ArrowRight, Music, Cat } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import AsciiAnimationWindow from '@/components/AsciiAnimationWindow';
// ===================== CONFIG =====================
const CONFIG = {
  title: "–î–ª—è –º–æ–µ–π –ª—é–±–∏–º–æ–π –ê—Ä–∑—É ‚ù§Ô∏è",
  access: {
    requirePass: true,
    passphrase: "–∫–∞–∫–∞—à–∫–∞",
    hint: "–ü–æ–¥—Å–∫–∞–∑–∫–∞: —Ç—ã –º–µ–Ω—è —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—à—å, –Ω–æ —ç—Ç–æ –Ω–µ –ø—Ä–∞–≤–¥–∞ üòá",
  },
  typewriterMessage:
    "–ö–∞–∂–¥—ã–π –¥–µ–Ω—å —Å —Ç–æ–±–æ–π ‚Äî —ç—Ç–æ –º–∞–ª–µ–Ω—å–∫–æ–µ —á—É–¥–æ. –°–ø–∞—Å–∏–±–æ –∑–∞ —Ç–≤–æ—é —É–ª—ã–±–∫—É, –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ —Ç–µ–ø–ª–æ. –¢—ã ‚Äî –º–æ—ë –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ.",
  reasons: [
    "–¢—ã –¥–µ–ª–∞–µ—à—å –º–∏—Ä –≤–æ–∫—Ä—É–≥ –¥–æ–±—Ä–µ–µ",
    "–° —Ç–æ–±–æ–π —É—é—Ç–Ω–æ –≤ –ª—é–±–æ–π —Ç–æ—á–∫–µ –ø–ª–∞–Ω–µ—Ç—ã",
    "–¢—ã —É–º–µ–µ—à—å —Å–ª—É—à–∞—Ç—å –∏ —Å–ª—ã—à–∞—Ç—å",
    "–¢–≤–æ–π —Å–º–µ—Ö ‚Äî –º–æ—è –ª—é–±–∏–º–∞—è –º—É–∑—ã–∫–∞",
    "–° —Ç–æ–±–æ–π —Ö–æ—á–µ—Ç—Å—è –º–µ—á—Ç–∞—Ç—å –∏ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å",
  ],
  gallery: [
    { src: "src/img/p1.jpeg", caption: "–ù–∞—à –ª—É—á—à–∏–π –¥–µ–Ω—å" },
    { src: "src/img/p2.jpeg", caption: "–ì–æ—Ä—ã –µ–µ–µ" },
    { src: "src/img/p3.jpeg", caption: "–ú–Ω–µ –æ—á–µ–Ω—å –Ω—Ä–∞–≤–∏—Ç—Å—è —ç—Ç–∞ —Ñ–æ—Ç–∫–∞" },
  ],
  // –±–∞–∑–æ–≤—ã–µ —Ü–≤–µ—Ç–∞ –æ—Å—Ç–∞—é—Ç—Å—è –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏, –Ω–æ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã —Ç–µ–ø–µ—Ä—å –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã –≤ JSX, —á—Ç–æ–±—ã Tailwind –Ω–µ –≤—ã—á–∏—â–∞–ª –∏—Ö
  colors: {
    accent: "from-pink-500 via-rose-500 to-fuchsia-500",
    bg: "bg-gradient-to-b from-rose-50 to-pink-50",
  },
  // ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∏–Ω–∏‚Äë–∏–≥—Ä—ã
  game: {
    // –°–∫–æ–ª—å–∫–æ –æ—á–∫–æ–≤ –Ω—É–∂–Ω–æ –¥–ª—è –ø–æ–±–µ–¥—ã
    winScore: 10,
    // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–≥—Ä—ã –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    durationSeconds: 20,
    // –ì–∏—Ñ–∫–∞/–∫–∞—Ä—Ç–∏–Ω–∫–∞ –∫–æ—Ç—ë–Ω–∫–∞. –ï—Å–ª–∏ –ø—É—Å—Ç–æ ‚Äî –±—É–¥–µ—Ç –∏–∫–æ–Ω–∫–∞
    kittenUrl: "https://media.tenor.com/V0AR3WV6qgoAAAAM/bf.gif",
  },
  // üî§ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ASCII-–∞–Ω–∏–º–∞—Ü–∏–∏
  ascii: {
    enabled: true,
    speedMs: 500,
    // –ú–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–∞–¥—Ä—ã. –°–æ–≤–µ—Ç—É: –¥–µ—Ä–∂–∏ —à–∏—Ä–∏–Ω—É –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π.
    frames: [
  String.raw`                                                                                                                                                                                 
                                                                                         ...                                                                                         
                                                                                 ..;;;;;;++++;;;;;...                                                                                
                                                                            ..;;;;++++++++++++++++++;;;;;...                                                                         
                                                                         ..;;++***+++++++++++++++++++++++++;...                                                                      
                                                                      .;;+++**++*+;;;...... .........;;++++++++;.                                                                    
                                                                   .;;++++++;;......                  ....;;+++++;..                                                                 
                                                                 .;;+++++;;..                              .;;+++++;..                                                               
                                                               .;+++*+;;.                                      .;+**++;.                                                             
                                                             .;;+++;;..                                         ..;+++++;.                                                           
                                                            .;+++;;.                                               .;++*++.                                                          
                                                          .;+++;.                                                    .;+*++;.                                                        
                                                        .;;+++..                                                      ..;+++;.                                                       
                                                       .;+++;.                                                          .;++*+;                                                      
                                                      .;+++;.                                                             .;+++;.                                                    
                                                     .;+*+;.                                                                .;++;.                                                   
                                                    .++++;                                                                   .;++;.                                                  
                                                   .++*+.                                                                     .;+++.                                                 
                                                  .;++;.                                                                       .;++;.                                                
                                                 .++++.                                                                         .;++;                                                
                                                .;+++.                                                                           .;++;                                               
                                               .;++;.                                                                             .;++.                                              
                                              .;++;.                                                                               ;+*;.                                             
                                             .;++;.                                                                                 .++;.                                            
                                            .;+*;.                                                                                  .;++;.                                           
                                            ;+*+.                                                                                     ;++;                                           
                                           ;+++;                                                                                      .;*+;                                          
                                          ;+*+;                                                                                        .;++;                                         
                                         .+**;.                                                                                         .;++.                                        
                                        .++++.                                                                                           .+*;.                                       
                                        ;**+;                                                                                             ;++;.                                      
                                       .+*+;                                                                             ...              .+++;.                                     
                                       ;+*+.             .;;.                                                           .;+;               .;++;                                     
                                      .+*+;              .;+.                                                           .+*;                .+*+.                                    
                                     .;+++.              .+*.                                                           .**;                 ;++;                                    
                                     .+*+.               .+*;                                                           .**;                 .;++;                                   
                                    .;*+;                .+*;.                                                          ;**;                  .+++.                                  
                                    ;+*+.                .+*;.                                                          ;**;                   ;**.                                  
                                    ;**;.                .+*;.              ..;;;..                .;;;;..              ;*+;                   ;+*;.                                 
                                   .+*+.                 .;*;.           ..;;++++;.     .;;..     .;+++++;;..           ;*+;                   .;*+.                                 
                                   ;+++.                 .;*;.          .;++*****+;    .;+*+;     ;+++*****+;.         .;**;                    ;++;                                 
                                  .+*+;                  .;*;.        .+++*******+;    .+**+;.    .;+++****+++.        .;**;                    .+*;                                 
                                  .**+.                  .;*+.       .++***+++;;;..    .++*+;.     ...;;;+++**+.       .;**;                    .+++.                                
                                  ;**;                   .;*+.      .;+**+++;;.        .;+*+.           ..;++*+;       .;**;                     +++;                                
                                 .;*+;                   .;*;.      .+**+;..            .++;               .;++.       .;**;                     ;++;                                
                                 .+*+.                   .;*;.      .;;;..               ++;                ...        .;**;                     .++;.                               
                                 .++;.                   .;*;.       ..                 .++;                           .;*+;                     .+++.                               
                                 ;+*;.                   .;*;.                         .;+++;.    ..                   .;*+;                     .+++.                               
                                 ;++;.                   .;*;.               ...;;;...;;++++++;..;;;;..                 ;*+;                     .;++.                               
                                 ;++;.                   .+*;               .;+++***++**+;;++**++****++.                .*+;                     .;++.                               
                                 ;+*;                    .+*;             .;+++++++++**+;...;+****+++++++;.             .**;                     .+++.                               
                                 ;+*;.                   ;+*;            .++++;;...;;+++;...;+*++;;.;;;+++;.            .+*+.                    .+++.                               
                                 ;+*;.                   ;**.           ;+*++.       ;+++;..++++.     .;+*+;.           .+++.                    .+++.                               
                                 ;+*;.                   ;**;        ...+++;.         ;++;;;+++.        ;+*+;..         .+++;                    .++;.                               
                                 ;+*;.                  .+*+.        ..;++;.          .+*+++++;          ;+++;..        .++++.                   ;++;                                
                                 ;+*+.                  ;+++.        .;+++.           .;*****;            ;+++..   ..    ;+*+.                   ;++.                                
                                 .+*+.                 .+++;.       .;+*+.             ;****+.             ;++;.   ..    .+**;                  .++;                                 
                                 .;*+;                 .+*+;.      ..;++;              ;+**++.             .;++;..  .     ;+*+.                 ;++;                                 
                                  .*+;                 ;**+.       .;+++.              .+**+;.              .++;..        ;+*+;                .+*+.                                 
                                  .+++;               .+*+;       ..+++.               ;***+;               .;++;.        .;**+;               ;+*;                                  
                                   ;+++.             .;+*+.       .;++;                ;+**+.                .+++;.        .++++.             .+++.                                  
                                    +**;.           .;+*+;        ;+++.                .++*+.                 ;+*;.         .+**+.           .+++.                                   
                                    .+*+;..        .;++++.       .;++;                 .+**+;                 .;*+.          ;+*++;.       .;++;.                                    
                                     ;++++;..    ..;+*++.        ;++;.                 ;***+;.                 .++;          .;++++;......;;+++.                                     
                                      ;+***++;;;;++***+;        .+*+.                  ;***++.                 .+++.           .+++**++++****+;                                      
                                       .;+*+++++++**+;.        .;+++.                 .;*++++.                  ;+++.           ..;+++++*+++;.                                       
                                        .;;+****++++;.         ;++;.                  ;++++++;                  .;++;.            .;;;++*+;..                                        
                                          .;**++++;.          .+++.                   ;++;;++;.                  .;**;.              ..;*+.                                          
                                           .**+..           .;+++.                   .+++..;++;                   .;+++.              .;*+.                                          
                                           .*+;            .;+++;                    .+++  .+++                    .;+*+;.             ;*+.                                          
                                           .*+;           .++++.                    .;++;  .+*+.                    .;**++.            ;*+.                                          
                                           .*+;          .+++;.                     ;+*;.   ;++;.                    ..++++;           ;*+.                                          
                                           .*+;          ;+;..                     .+*+.    .;++.                      .;++;           ;*+.                                          
                                           .*+;          ..                        +++;.     ;**;                        ..            ;*+;                                          
                                           ;*+;                                  .;+++.      .+++.                                     ;*+;                                          
                                           ;*+;                                  ;+++;       .;++;                                     ;*+;                                          
                                           ;*+;                                 ;+**;         .+*+.                                    .*+;                                          
                                          .;*+.                                .+++;.          ;+*+.                                   .*+;                                          
                                          .;*+.                               .++++.           .;++;.                                  .**;                                          
                                          .;*;.                              ;+**+.             .;+++.                                 .**;                                          
                                          .+*;.                            .;+++;.               .+++;.                                .++;                                          
                                          .+*;.                            ;+*+;.                 ;+++;.                               .++;                                          
                                          ;+*;                            ;+**;.                   .++*+.                              .+++.                                         
                                          ;+*.                          .;+++;.                     .++++.                             .+++.                                         
                                          ;+*.                         .;+++;.                       .;+*+.                            .+++.                                         
                                          ;*+.                        .++*+;                          .++*+;                            ;++.                                         
                                          ;*+.                       ;++*+;.                           .;+*+;.                          ;++.                                         
                                          +++.                      ;+*++;                              .;+++;                          ;++;                                         
                                         .++;.                     .+*++;                                 .+++.                         ;++;                                         
                                         .++;                      .;;;.                                   ...                          ;++;                                         
                                         .++;                       ..                                                                  .++;                                         
                                         .++.                                                                                           .++;                                         
                                         ;++.                                                                                            ;+;                                         
                                         ;++.                                                                                            ;++.                                        
                                         ;++.                                                                                            ;++.                                        

  `,
  String.raw`                                                                                                                                                                                
                                                                                                                                                         ..     ...                  
                                                                                  ..  .................                                                  ...     ..                  
                 .                                                             ......;;;;;;;;;;;;;;;.....                                                 ..     ..                  
                ..                                                       ......;;;;;;;;;;;;;;;;;;;;;;;;;;;....                                            ...    ..                  
               ...                                                   ......;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;.....                                        ...    ...                 
               ..                                                   ...;;;;;;;;;;;;................;;;;;;;;;;;;;;..                                        ..    ...                 
              ...                                                ...;;;;;;;;;.........          ..........;;;;;;;;;;...                                    ..     ..                 
              ..                                              ....;;;;;;;;....                          ....;;;;;;;;;;....                                 ..     ..                 
              ..                                             ..;;;;;;;...                                    ....;;;;;;;...                                ..     ..                 
             ..                                            ...;;;;;;....                                       .....;;;;;;...                              ...    ..                 
             ..                                           ..;;;;;;..                                               ...;;;;;;...                            ...    ..                 
             ..                                          .;;;;;;..                                                   ...;;;;;;.                             ..    ...                
             ..                                       ...;;;;;...                                                      ...;;;;;..                           ..    ...                
            ...                                      ...;;;;..                                                           ..;;;;;..                          ..    ...                
            ...                                     ..;;;;;..                                                              ..;;;;;..                        ..    ...                
            ...                                    ..;;;;...                                                                ...;;;;..                       ..    ...                
            ...                                  ..;;;;;..                                                                    ..;;;;..                      ..     .                 
            ...                                 ..;;;;..                                                                        ..;;;;.                     ..                       
            ...                                ..;;;;..                                                                          ..;;;;..                   ..                       
            ...                               ..;;;;.                                                                              .;;;;..                  ..                       
            ...                              ..;;;;.                                                                                .;;;;..                 ..                       
            ...                             ..;;;..                                                                                 ..;;;;..                                         
            ...                            ..;;;..                                                                                    .;;;;;.                                        
            ...                           ..;;;..                                                                                      .;;;;;.                                       
            ...                          ..;;;..                                                                                        .;;;;;..                                     
            ...                         ..;;;..                                                                                          .;;;;;..                                    
      .     ...                        ..;;;..                          ......                         .......                            .;;;;;..                                   
      ..    ...                      ..;;;;..                        ...;;;;;;..                     ...;;;;;...                           ..;;;;..                                  
      ..    ...                      .;;;;..                         .;;;;;;;;;..                   ..;;;;;;;;;.                            ..;;;;..                                 
      .     ...                     .;;;;..                         .;;;;..;;;;;..                 ..;;;...;;;;;.                            ..;;;;.                                 
      .      ..                   ..;;;;..             ..          ..;;;....;;;;;.       ...       .;;;....;;;;;;.                            ..;;;;.                                
      ..     ...                  .;;;;..             ....         .;;;.   ..;;;;.      .....      .;;.   .;;;;;;.           ...               ..;;;;.                               
      ..     ...                 .;;;;..              .;;.        ..;;..   .;;;;;..    .;;;;..    ..;;.  ..;;;;;;..          .;;.               ..;++;.                              
      ..      ...               .;;;;..               .;;..       ..;;;....;;;;;;..    .;;;;..    .;;;....;;;;;;;..          .;;.                .;+*+;                              
      ..      ...              ..;;;..               .;;;..       ..;;;...;;;;;;;;.    .;;;;..    .;;;;;;;;;;;;;;..          ;;;.                 .;+*+.                             
      ...      ...             .;;;..                .;;;..       ..;;;;;;;;..;;;..    ..;;;.     .;;;;;;;...;;;;..          ;;;.                  .+++;                             
      ...      ...            ..;;;.                 .;;;..       ..;;;;;;;....;;..     .;;..     ..;;;;;.  .;;;;..         .;;;.                   ;+++.                            
       ..      ....          ..;;;.                  .;;;..        .;;;;;;;. ..;;.      .;;..      .;;;;;....;;;;.          .;;;..                  .;**;                            
       ...      ...          .;;;..                 ..;;;.         ..;;;;;;;.;;;;.      .;;..      ..;;;;;;;;;;;..          .;;;..                   ;+*+.                           
        ..                  ..;;;.                  ..;;;.          ..;;;;;;;;;;..    ...;;;...     ..;;;;;;;;;..           .;;;..                   .+*+;                           
        ...                 .;;;..                  .;;;;.            ..;;;;;;;....  ..;;;;;;;...    ..;;;;;;;..            .;;;..                   .;**+.                          
         ...                .;;;.                   .;;;;.     ...     ..........;...;;;;;;;;;;;............... ......       ;;;..                    .+*+.                          
          ...              .;+;.                    .;;;;.   .......      .    .;;;;;;;;;..;;;;;;;;;.    ...   ........      ;;;;.                     +++;.                         
          ....             .++;.                    .;;;..  .........          ..;;;;;........;;;;;;.         ..........     ;;;;.                     ;+++.                         
           ...             ;++;.                    .;;;.. ...........          ..;;;...........;;;.          ...........    .;;;.                     .;*+.                         
                           ;++;.                   ..;;;.. ............          ..;;...........;;;.          ...........    .;;;.                      ;*+.                         
                           +*+.                    ..;;;.  ............          ..;;...........;;..         ............    .;;;.                      ;**;                         
                          .+*+.                    .;;;;   ............          ..;;..........;;;..          ...........    .;;;.                      ;**;                         
                          .+*+.                    .;;;.   ............          ..;;;.........;;;.           ..........     .;;;;                      ;**;.                        
                          .+*+.                    .;;;.   ............           .;;;;......;;;;.            ..........     ..;;;.                     ;**;.                        
                          .+*+.                    ;;;;.   ...........             .;;;;;;;;;;;;..             ........      ..;;;.                     ;**;.                        
                          .+*+.                   .;;;..   ...........              ..;;;;;;;;;..               ......        .;;;..                   .;**;                         
                          .+*+.                  ..;;;..     ........                ....;;;;..                   ..          .;;;;.                   .;**.                         
                           +*+.                  .;;;;.          .                    ........                                ..;;;.                   ;+*+.                         
                           ;*+;                 ..;;;..                                                                       ..;++;.                 .++++.                         
                           ;+*;.                .;;;;.                                                                          ;+*+;                 .+*+;                          
                           .;*+;               ;;++;.                                                                           .;*++;               .+*++.                          
                            ;+*;.             .+++;..                                                                            .++++;.           ..++*++....                       
                            .+++;.           .+**+;.                                                                              .+**+;..      ..;+****+++++;.                      
                             .+*+;.        .;++*+;                                                                                 ;+**++++;;;;;++++********+++;;                    
                           ..;+**+;........;+*++;.                                                                                  .;+*****++++**+++;;;;;;;+++++;.                  
                         .;+++******+++++++***+;.                                                                                     ;+********+++;..      .;+**+;.                 
                       .;+++++*******++++***+;.                                                                                        ..;;***+;;..           .;**+;                 
                     .;+++++;;;;++++++******+;.                                                                                         .;+*++;.               .++++.                
                     ;+**+;.    ...;++++*+*++;.                                                                                         ;+**;.                  .+**;.               
                   .;+++;.           ...;+++*++;.                                                                                     .;+++;.                    ;+*+;               
                   .+++;.               ..;;++++;.                                                                                    ;+*+;.                     ;+*+;               
                  .;*+;                     .;+**+.                                                                                  ;+*+;                       .+*+;               
                  ;+*+.                      ..++++;                                                                                ;+++;                        .+*+;               
                  ;++;                         .;+*+;                                                                              ;+*+;                         ;+*+;               
                  +*+.                          .;**+.                                                                            .+*+.                          ;**;.               
                 .+*+.                           ..+++.                                                                          .+++;                          .+*+;                
                 .+*+.                             .;+.                                                                          .++;                          .++++.                
                 .+*+.                              .;.                                                                          .;.                           .+*+;.                
                 .+++                                                                                                                                         .+**+.                 
                 .+*+.                                                                                                                                       .;+*+;                  
                 .+*+.                                                                                                                                      .++**;                   
                  ;+*+.                                                                                                                                   .;++*+;.                   
                  .;*+;.                                                                                                                                 .;+**+;.                    
                   .+*++.                                                                                                                              .;+****;.                     
                   .;+*+;.                                                                                                                          ..;++**+;..                      
                    .;+*+;.                                                                                                                        .;++*+++;.                        
                     .;***+;.                                                                                                                    .;+****+;.                          
                      .;+*+++;..                                                                                                               .;++**++;.                            
                       .;++**++;..                                                                                                           .;++*+++;.                              
                         .;+****++;.                                                                                                        ;+****+;.                                
                          ..;++**+++;;.                                                                                                   .;++*++;.                                  
                            ..;++++**++;.                                                                                                .;**++;.                                    
                                .;+****++;.                                                                                            .;+***+.                                      
                                  ..;+**+++;..                                                                                         .++++;.                                       
                                    ..;++**++;.                                                                                        ;++++.                                        
                                       .;++***+.                                                                                       .++++.                                        
                                        ..+***++;.                                                                                      .;++.                                        
                                          ;+++++;.                                                                                       ;+*.                                        
                                          ++;..;;.                                                                                       ;+*.                                        
  `
]

,
  }
};
// ==================================================

function useTypewriter(text: string, speed = 30) {
  const [out, setOut] = useState("");
  useEffect(() => {
    setOut("");
    let i = 0;
    const id = setInterval(() => {
      setOut((prev) => (i < text.length ? prev + text[i++] : prev));
      if (i >= text.length) clearInterval(id);
    }, speed);
    return () => clearInterval(id);
  }, [text, speed]);
  return out;
}

function FloatingHearts() {
  const hearts = useMemo(
    () => Array.from({ length: 24 }).map((_, i) => ({
      id: i,
      delay: Math.random() * 4,
      duration: 8 + Math.random() * 10,
      x: Math.random() * 100,
      size: 16 + Math.random() * 28,
      opacity: 0.3 + Math.random() * 0.5,
    })),
    []
  );
  return (
    <div className="pointer-events-none absolute inset-0 overflow-hidden">
      {hearts.map((h) => (
        <motion.div
          key={h.id}
          initial={{ y: "100%", x: `${h.x}%`, opacity: 0 }}
          animate={{ y: "-10%", opacity: h.opacity }}
          transition={{ duration: h.duration, repeat: Infinity, delay: h.delay, ease: "easeOut" }}
          className="absolute"
          style={{ left: `${h.x}%` }}
        >
          <Heart className="drop-shadow" style={{ width: h.size, height: h.size }} />
        </motion.div>
      ))}
    </div>
  );
}

function HeartGame({ onFinish }: { onFinish: (score: number) => void }) {
  const [running, setRunning] = useState(false);
  const [score, setScore] = useState(0);
  const [timeLeft, setTimeLeft] = useState(CONFIG.game?.durationSeconds ?? 20);
  const [hearts, setHearts] = useState(
    Array.from({ length: 8 }).map((_, i) => ({ id: i, x: Math.random() * 100, y: Math.random() * 60 }))
  );

  useEffect(() => {
    if (!running) return;
    const timer = setInterval(() => setTimeLeft((t) => (t > 0 ? t - 1 : 0)), 1000);
    const mover = setInterval(() => {
      setHearts((arr) =>
        arr.map((h) => ({
          ...h,
          x: Math.min(96, Math.max(2, h.x + (Math.random() * 20 - 10))),
          y: Math.min(70, Math.max(10, h.y + (Math.random() * 18 - 9))),
        }))
      );
    }, 650);
    return () => {
      clearInterval(timer);
      clearInterval(mover);
    };
  }, [running]);

  useEffect(() => {
    if (running && timeLeft === 0) {
      setRunning(false);
      onFinish(score);
    }
  }, [running, timeLeft, score, onFinish]);

  const start = () => {
    setScore(0);
    setTimeLeft(CONFIG.game?.durationSeconds ?? 20);
    setRunning(true);
  };

  return (
    <Card className="relative overflow-hidden">
      <CardHeader className="pb-2">
        <CardTitle className="flex items-center gap-2 text-lg">
          <Sparkles size={18} /> –ú–∏–Ω–∏‚Äë–∏–≥—Ä–∞: –ø–æ–π–º–∞–π —Å–µ—Ä–¥–µ—á–∫–∏
        </CardTitle>
      </CardHeader>
      <CardContent>
        <div className="flex items-center justify-between mb-3">
          <div className="flex items-center gap-2"><Timer size={18}/> –û—Å—Ç–∞–ª–æ—Å—å: <b>{timeLeft}s</b></div>
          <div className="flex items-center gap-2"><Trophy size={18}/> –°—á—ë—Ç: <b>{score}</b></div>
        </div>
        <div className="relative h-64 rounded-2xl border bg-white/60 overflow-hidden">
          {!running && (
            <div className="absolute inset-0 grid place-content-center bg-white/60 backdrop-blur-sm z-10">
              <Button onClick={start} className="text-base">
                –ù–∞—á–∞—Ç—å –∏–≥—Ä—É <ArrowRight className="ml-2" size={18} />
              </Button>
            </div>
          )}
          {hearts.map((h) => (
            <motion.button
              key={h.id}
              whileTap={{ scale: 0.9 }}
              onClick={() => running && setScore((s) => s + 1)}
              className="absolute"
              style={{ left: `${h.x}%`, top: `${h.y}%` }}
              type="button"
            >
              <Heart />
            </motion.button>
          ))}
        </div>
      </CardContent>
    </Card>
  );
}

function ReasonsCarousel({ items }: { items: string[] }) {
  const [index, setIndex] = useState(0);
  const next = () => setIndex((i) => (i + 1) % items.length);
  const prev = () => setIndex((i) => (i - 1 + items.length) % items.length);
  return (
    <Card>
      <CardHeader className="pb-2">
        <CardTitle className="flex items-center gap-2 text-lg">
          <Gift size={18} /> –ü–æ—á–µ–º—É —è —Ç–µ–±—è –ª—é–±–ª—é
        </CardTitle>
      </CardHeader>
      <CardContent>
        <div className="flex items-center justify-between gap-2">
          <Button variant="outline" onClick={prev}>–ù–∞–∑–∞–¥</Button>
          <div className="flex-1 text-center text-lg font-medium px-4 min-h-12 grid place-content-center">
            <AnimatePresence mode="wait">
              <motion.div
                key={index}
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                exit={{ opacity: 0, y: -10 }}
                transition={{ duration: 0.25 }}
              >
                ‚Äú{items[index]}‚Äù
              </motion.div>
            </AnimatePresence>
          </div>
          <Button onClick={next}>–î–∞–ª—å—à–µ</Button>
        </div>
      </CardContent>
    </Card>
  );
}

// ===== ASCII Animation Block =====
function AsciiAnimation({ frames, speedMs = 120 }: { frames: string[]; speedMs?: number }) {
  const [i, setI] = useState(0);
  useEffect(() => {
    const id = setInterval(() => setI((n) => (n + 1) % frames.length), Math.max(60, speedMs));
    return () => clearInterval(id);
  }, [frames.length, speedMs]);
  return (
    <Card className="backdrop-blur bg-white/70">
  <CardHeader>
    <CardTitle className="flex items-center gap-2 text-lg">
      –î–û–õ–ì–û–ñ–î–ê–ù–ù–ê–Ø –ê–ù–ò–ú–ê–¶–ò–Ø!
    </CardTitle>
  </CardHeader>
  <CardContent>
    <div className="w-full h-[50rem] overflow-auto rounded-lg border bg-white/60 p-2">
      <pre className="font-mono text-[8px] leading-[8px] whitespace-pre">
        {frames[i]}
      </pre>
    </div>
  </CardContent>
</Card>

  );
}

function Gallery({ items }: { items: { src: string; caption?: string }[] }) {
  return (
    <Card>
      <CardHeader className="pb-2">
        <CardTitle className="flex items-center gap-2 text-lg"><Camera size={18}/> –ù–∞—à–∞ –≥–∞–ª–µ—Ä–µ—è</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="grid md:grid-cols-3 gap-4">
          {items.map((g, i) => (
            <figure key={i} className="rounded-2xl overflow-hidden border bg-white/60">
              <img src={g.src} alt={g.caption ?? `image-${i}`} className="w-full h-48 object-cover" />
              {g.caption && <figcaption className="p-2 text-sm text-center opacity-80">{g.caption}</figcaption>}
            </figure>
          ))}
        </div>
      </CardContent>
    </Card>
  );
}

export default function GiftPage() {
  const [unlocked, setUnlocked] = useState(!CONFIG.access.requirePass);
  const [input, setInput] = useState("");
  const [errorMsg, setErrorMsg] = useState("");
  const [showCongrats, setShowCongrats] = useState<{ open: boolean; score: number } | null>(null);
  const typed = useTypewriter(CONFIG.typewriterMessage, 18);
  const musicRef = useRef<HTMLAudioElement | null>(null);

  const onUnlock = () => {
    if (!CONFIG.access.requirePass) return setUnlocked(true);
    const ok = input.trim().toLowerCase() === CONFIG.access.passphrase.trim().toLowerCase();
    if (ok) {
      setUnlocked(true);
      setErrorMsg("");
    } else {
      setErrorMsg("–û—à–∏–±–ª–∞—Å—å, –∫—Ä–∏–Ω–∂");
    }
  };

  useEffect(() => {
    if (unlocked) {
      setTimeout(() => window.scrollTo({ top: 120, behavior: "smooth" }), 250);
    }
  }, [unlocked]);

  return (
    <div className="bg-gradient-to-b from-rose-50 to-pink-50 min-h-screen relative">
      <FloatingHearts />

      {/* –£–±—Ä–∞–ª –ø—É—Å—Ç–æ–π src, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–∞. –ó–∞–¥–∞–π –ø—É—Ç—å –∫ mp3, –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –º—É–∑—ã–∫–∞ */}
      {/* <audio ref={musicRef} src="/music.mp3" loop /> */}

      <div className="container mx-auto px-4 py-8 max-w-3xl relative z-10">
        <header className="flex items-center justify-between mb-6">
          <h1 className="text-2xl md:text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-pink-500 via-rose-500 to-fuchsia-500">
            {CONFIG.title}
          </h1>
          <Button
            variant="ghost"
            onClick={() => {
              if (!musicRef.current) return;
              if (musicRef.current.paused) musicRef.current.play(); else musicRef.current.pause();
            }}
            title="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É"
          >
            <Music size={20} />
          </Button>
        </header>

        {!unlocked ? (
          <Card className="backdrop-blur bg-white/70">
            <CardHeader>
              <CardTitle className="flex items-center gap-2"><Lock size={20}/> –°–µ–∫—Ä–µ—Ç–Ω–æ–µ —Å–ª–æ–≤–æ</CardTitle>
            </CardHeader>
            <CardContent className="grid gap-3">
              <p className="opacity-80">{CONFIG.access.hint}</p>
              <div className="flex gap-2">
                <Input
                  placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ"
                  value={input}
                  onChange={(e) => setInput(e.target.value)}
                  onKeyDown={(e) => e.key === 'Enter' && onUnlock()}
                />
                <Button onClick={onUnlock}>
                  –û—Ç–∫—Ä—ã—Ç—å <Unlock className="ml-2" size={18} />
                </Button>
              </div>
              {errorMsg && <p className="text-red-500 text-sm">{errorMsg}</p>}
            </CardContent>
          </Card>
        ) : (
          <div className="grid gap-6">


            <ReasonsCarousel items={CONFIG.reasons} />

            {CONFIG.ascii?.enabled && (
              <AsciiAnimation frames={CONFIG.ascii.frames} speedMs={CONFIG.ascii.speedMs} />
            )}

            <HeartGame onFinish={(score) => setShowCongrats({ open: true, score })} />

            <Gallery items={CONFIG.gallery} />
          </div>
        )}
      </div>

      <AnimatePresence>
        {showCongrats?.open && (
          <motion.div
            className="fixed inset-0 grid place-content-center bg-black/40 backdrop-blur-sm z-50 p-4"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
          >
            <Card className="max-w-md mx-auto text-center">
              <CardHeader>
                <CardTitle className="flex items-center justify-center gap-2">
                  <Trophy /> –£—Ä–∞!
                </CardTitle>
              </CardHeader>
              <CardContent className="grid gap-3">
                <p>–¢–≤–æ–π —Å—á—ë—Ç: <b>{showCongrats.score}</b></p>
                <p className="opacity-80">–¢—ã ‚Äî –º–æ—ë —Å–∞–º–æ–µ –±–æ–ª—å—à–æ–µ –≤–µ–∑–µ–Ω–∏–µ. –õ—é–±–ª—é —Ç–µ–±—è! ‚ù§Ô∏è</p>
                {showCongrats.score >= (CONFIG.game?.winScore ?? 12) && (
                  <motion.div
                    initial={{ scale: 0 }}
                    animate={{ scale: 1 }}
                    transition={{ type: "spring", stiffness: 200, damping: 12 }}
                    className="flex flex-col items-center gap-2"
                  >
                    {CONFIG.game?.kittenUrl ? (
                      <motion.img
                        src={CONFIG.game.kittenUrl}
                        alt="kitten"
                        className="w-48 h-48 object-cover rounded-xl"
                        initial={{ scale: 0.6, rotate: -10, opacity: 0 }}
                        animate={{ scale: 1, rotate: 0, opacity: 1 }}
                        transition={{ type: 'spring', stiffness: 220, damping: 14 }}
                      />
                    ) : (
                      <Cat size={48} className="text-pink-500" />
                    )}
                    <p className="text-sm opacity-80">–ú—è—É! –ö–æ—Ç—ë–Ω–æ–∫ –ø–æ–∑–¥—Ä–∞–≤–ª—è–µ—Ç —Å –ø–æ–±–µ–¥–æ–π üêæ</p>
                  </motion.div>
                )}
                <Button onClick={() => setShowCongrats(null)}>–ó–∞–∫—Ä—ã—Ç—å</Button>
              </CardContent>
            </Card>
          </motion.div>
        )}
      </AnimatePresence>

      <footer className="text-center text-xs opacity-60 py-6">–°–¥–µ–ª–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é ‚Ä¢ {new Date().getFullYear()}</footer>
    </div>
  );
}
